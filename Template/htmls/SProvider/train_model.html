{% extends 'SProvider/design1.html' %}
{% block researchblock %}

<div class="container">
    <div class="header text-center mb-4">
        <h2><i class="fas fa-brain"></i> Machine Learning Model Training</h2>
        <p class="text-muted">Train models with different users and datasets</p>
    </div>

    <!-- User Selection Form -->
    <div class="card mb-4">
        <div class="card-header">
            <h4><i class="fas fa-users"></i> Training Configuration</h4>
        </div>
        <div class="card-body">
            <form method="POST">
                {% csrf_token %}
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="selected_user" class="form-label">
                                <i class="fas fa-user"></i> Select User for Training
                            </label>
                            <select class="form-select" id="selected_user" name="selected_user">
                                <option value="">-- Use Main Dataset (Default) --</option>
                                {% for user in users %}
                                <option value="{{ user.username }}">{{ user.username }} ({{ user.email }})</option>
                                {% endfor %}
                            </select>
                            <small class="text-muted">Select a user to train with their specific data, or leave empty for main dataset</small>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="use_user_data" name="use_user_data">
                                <label class="form-check-label" for="use_user_data">
                                    <i class="fas fa-database"></i> Use User-Specific Data
                                </label>
                            </div>
                            <small class="text-muted">Check this to train models using only the selected user's prediction data</small>
                        </div>
                    </div>
                </div>
                <div class="text-center">
                    <button type="submit" class="btn btn-primary btn-lg">
                        <i class="fas fa-play"></i> Start Training
                    </button>
                </div>
            </form>
        </div>
    </div>

    {% if objs %}
    <div class="card">
        <div class="card-header text-center">
            <h3><i class="fas fa-chart-line"></i> Model Accuracy Comparison</h3>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th><i class="fas fa-robot"></i> Model Type</th>
                            <th><i class="fas fa-user"></i> Trained By</th>
                            <th><i class="fas fa-percentage"></i> Accuracy (%)</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for object in objs %}
                        <tr>
                            <td>
                                <div class="d-flex align-items-center">
                                    {% if "Neural" in object.names %}
                                        <i class="fas fa-brain text-primary me-2"></i>
                                    {% elif "SVM" in object.names %}
                                        <i class="fas fa-chart-bar text-success me-2"></i>
                                    {% elif "Logistic" in object.names %}
                                        <i class="fas fa-chart-line text-info me-2"></i>
                                    {% elif "Decision" in object.names %}
                                        <i class="fas fa-sitemap text-warning me-2"></i>
                                    {% elif "Random Forest" in object.names %}
                                        <i class="fas fa-tree text-success me-2"></i>
                                    {% else %}
                                        <i class="fas fa-cog text-secondary me-2"></i>
                                    {% endif %}
                                    {{object.names}}
                                </div>
                            </td>
                            <td>
                                <span class="badge bg-info">
                                    <i class="fas fa-user"></i> {{object.user_trained}}
                                </span>
                            </td>
                            <td>
                                <div class="d-flex align-items-center">
                                    <div class="progress me-2" style="width: 100px; height: 8px;">
                                        <div class="progress-bar" role="progressbar" 
                                             style="width: {{object.ratio}}%; background: linear-gradient(45deg, #667eea, #764ba2);" 
                                             aria-valuenow="{{object.ratio}}" aria-valuemin="0" aria-valuemax="100">
                                        </div>
                                    </div>
                                    <span class="fw-bold">{{object.ratio}}%</span>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-md-4">
            <div class="card">
                <div class="card-header text-center">
                    <h4><i class="fas fa-trophy"></i> Best Performing Model</h4>
                </div>
                <div class="card-body text-center">
                    {% with best_model=objs|dictsort:"ratio"|last %}
                    <div class="display-4 text-primary mb-2">{{best_model.ratio}}%</div>
                    <h5 class="text-muted">{{best_model.names}}</h5>
                    <div class="badge bg-success mt-2">
                        <i class="fas fa-medal"></i> Highest Accuracy
                    </div>
                    <div class="badge bg-info mt-1">
                        <i class="fas fa-user"></i> {{best_model.user_trained}}
                    </div>
                    {% endwith %}
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-header text-center">
                    <h4><i class="fas fa-info-circle"></i> Training Summary</h4>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-6">
                            <div class="h4 text-primary">{{objs|length}}</div>
                            <small class="text-muted">Models Trained</small>
                        </div>
                        <div class="col-6">
                            <div class="h4 text-success">
                                {% with avg_accuracy=objs|dictsort:"ratio"|slice:":1" %}
                                    {% for obj in objs %}
                                        {% if forloop.first %}
                                            {{obj.ratio}}
                                        {% endif %}
                                    {% endfor %}
                                {% endwith %}%
                            </div>
                            <small class="text-muted">Best Accuracy</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-header text-center">
                    <h4><i class="fas fa-users"></i> User Performance</h4>
                </div>
                <div class="card-body">
                    <div class="text-center">
                        {% regroup objs by user_trained as user_list %}
                        {% for user in user_list %}
                        <div class="mb-2">
                            <div class="badge bg-primary">{{user.grouper}}</div>
                            <div class="small text-muted">{{user.list|length}} models</div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% else %}
    <div class="card">
        <div class="card-body text-center">
            <div class="icon mb-3">
                <i class="fas fa-exclamation-triangle" style="font-size: 3em; color: #ffc107;"></i>
            </div>
            <h4>No Training Data Available</h4>
            <p class="text-muted">Please select training options above and click "Start Training" to begin the process.</p>
        </div>
    </div>
    {% endif %}
</div>

<style>
.progress {
    background-color: #e9ecef;
    border-radius: 10px;
    overflow: hidden;
}

.progress-bar {
    transition: width 0.6s ease;
}

.badge {
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 0.8em;
}

.bg-success {
    background: linear-gradient(45deg, #28a745, #20c997) !important;
}

.bg-info {
    background: linear-gradient(45deg, #17a2b8, #20c997) !important;
}

.bg-primary {
    background: linear-gradient(45deg, #007bff, #0056b3) !important;
}

.text-primary {
    color: #667eea !important;
}

.text-success {
    color: #28a745 !important;
}

.text-info {
    color: #17a2b8 !important;
}

.text-warning {
    color: #ffc107 !important;
}

.text-secondary {
    color: #6c757d !important;
}

.display-4 {
    font-size: 2.5rem;
    font-weight: 300;
    line-height: 1.2;
}

.fw-bold {
    font-weight: 600 !important;
}

.me-2 {
    margin-right: 0.5rem !important;
}

.mt-2 {
    margin-top: 0.5rem !important;
}

.mt-1 {
    margin-top: 0.25rem !important;
}

.mb-2 {
    margin-bottom: 0.5rem !important;
}

.mb-3 {
    margin-bottom: 1rem !important;
}

.mt-4 {
    margin-top: 1.5rem !important;
}

.h4 {
    font-size: 1.5rem;
    font-weight: 500;
}

.h5 {
    font-size: 1.25rem;
    font-weight: 500;
}

.form-select, .form-check-input {
    border: 2px solid #e9ecef;
    border-radius: 10px;
    transition: all 0.3s ease;
}

.form-select:focus, .form-check-input:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
}

.btn-primary {
    background: linear-gradient(45deg, #667eea, #764ba2);
    border: none;
    border-radius: 25px;
    padding: 12px 30px;
    font-weight: 600;
    transition: all 0.3s ease;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
}

.small {
    font-size: 0.875em;
}
</style>

{% endblock %}